import pefile
import os

def main():

    sampledir = os.getcwd() + os.sep + 'sample'
    items = os.listdir(sampledir)
    for item in items:
        path = os.path.join(sampledir, item)
        if os.path.isfile(path):
            try:
                selfpe=pefile.PE(path)
                print(item)
                _get_pdb(selfpe)
            except pefile.PEFormatError:
                continue
    
    
        
def _get_pdb(selfpe):
        # get the path to any available debugging symbols.
        try:
            for entry in getattr(selfpe, "DIRECTORY_ENTRY_DEBUG", []):
                raw_offset = entry.struct.PointerToRawData
                size_data = entry.struct.SizeOfData
                debug_data = selfpe.__data__[raw_offset:raw_offset+size_data]

                if debug_data.startswith(b"RSDS"):
                    # pdb path
                    pdb = debug_data[24:].strip(b"\x00").decode("utf-8").strip("0")
                    print(pdb)

        except Exception as e:
            print("extract pdb information error: {}".format(e))
            return
            
            
main()