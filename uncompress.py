import zipfile
import py7zr
import os

passwd = 'infected'

def uncompress(path_name):

    global passwd
    
    print(path_name)
    suffix = path_name.rsplit('.', 1)[1]
    if suffix == 'zip':
        if zipfile.is_zipfile(path_name):
            try:
                zip_file = zipfile.ZipFile(path_name)
                zip_list = zip_file.namelist()  # get all files in zip
                for f in zip_list:
                    zip_file.extract(f,r'E:\Exclude\new\MalwareBazaar', pwd=passwd.encode("utf-8"))
            except Exception as e:
                print('Error when uncompress file! info: ', e)
                return False
            else:
                return True
        else:
            print('This is not a true zip file!')
            return False
    if suffix == '7z':
        if py7zr.is_7zfile(path_name):
            try:
                with py7zr.SevenZipFile(path_name,password=passwd, mode='r') as sevenZ_f:
                    sevenZ_f.extractall(path_name.rsplit(".7z")[0])
            except Exception as e:
                print('Error when uncompress file! info: ', e)
                return False
            else:
                return True
        else:
            print('This is not a true 7z file!')
            return False


if __name__ == '__main__':
    folder_name = input("please input folder--for example--E:\\workspace\\unzipTestï¼š")
    count = 0
    os.chdir(folder_name)
    files = os.listdir(folder_name)
    for f in files:
        f_path = folder_name + os.sep + f
        if os.path.isfile(f_path):
            print("uncompress--"+f)
            bool = uncompress(path_name=f_path)
            if bool == True:
                os.remove(f_path)
            count = count + 1
            print(count)
    print("uncompress complete!")
